<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Scheduler Simulator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .timeline-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        .timeline {
            display: flex;
            height: 50px;
            margin: 20px 0;
        }
        .timeline-block {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 2px;
        }
        .process-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .results-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">CPU Scheduler Simulator</h1>
        
        <div class="process-form">
            <div class="row mb-3">
                <div class="col-md-4">
                    <select id="algorithm" class="form-select">
                        <option value="FCFS">First Come First Serve (FCFS)</option>
                        <option value="SJF">Shortest Job First (SJF)</option>
                        <option value="RR">Round Robin (RR)</option>
                    </select>
                </div>
                <div class="col-md-4" id="quantum-container" style="display: none;">
                    <input type="number" id="quantum" class="form-control" value="2" min="1" placeholder="Time Quantum">
                </div>
            </div>

            <div id="processes-container">
                <!-- Process inputs will be added here -->
            </div>

            <button class="btn btn-primary me-2" onclick="addProcess()">Add Process</button>
            <button class="btn btn-success" onclick="simulate()">Simulate</button>
        </div>

        <div class="results-section" id="results" style="display: none;">
            <h3>Simulation Results</h3>
            <div class="timeline-container">
                <div id="timeline" class="timeline"></div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h4>Process Metrics</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Process</th>
                                <th>Turnaround Time</th>
                                <th>Waiting Time</th>
                            </tr>
                        </thead>
                        <tbody id="metrics-table"></tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h4>Average Metrics</h4>
                    <p>Average Turnaround Time: <span id="avg-turnaround"></span></p>
                    <p>Average Waiting Time: <span id="avg-waiting"></span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let processCount = 0;
        const colors = [
            '#4285f4', '#ea4335', '#fbbc05', '#34a853',
            '#ff6d01', '#46bdc6', '#7baaf7', '#f07b72'
        ];

        document.getElementById('algorithm').addEventListener('change', function() {
            const quantumContainer = document.getElementById('quantum-container');
            quantumContainer.style.display = this.value === 'RR' ? 'block' : 'none';
        });

        function addProcess() {
            const container = document.getElementById('processes-container');
            const processDiv = document.createElement('div');
            processDiv.className = 'row mb-3';
            processDiv.innerHTML = `
                <div class="col-md-3">
                    <input type="number" class="form-control" placeholder="Arrival Time" 
                           id="arrival-${processCount}" min="0" value="0">
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" placeholder="Burst Time" 
                           id="burst-${processCount}" min="1" value="1">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">
                        Remove
                    </button>
                </div>
            `;
            container.appendChild(processDiv);
            processCount++;
        }

        function getProcesses() {
            const processes = [];
            document.querySelectorAll('#processes-container .row').forEach((row, index) => {
                const arrivalTime = parseInt(row.querySelector('input[id^="arrival-"]').value);
                const burstTime = parseInt(row.querySelector('input[id^="burst-"]').value);
                processes.push({
                    id: index,
                    arrival_time: arrivalTime,
                    burst_time: burstTime
                });
            });
            return processes;
        }

        function simulate() {
            const algorithm = document.getElementById('algorithm').value;
            const quantum = parseInt(document.getElementById('quantum').value);
            const processes = getProcesses();

            if (processes.length === 0) {
                alert('Please add at least one process');
                return;
            }

            fetch('/simulate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    algorithm: algorithm,
                    processes: processes,
                    quantum: quantum
                }),
            })
            .then(response => response.json())
            .then(data => displayResults(data));
        }

        function displayResults(data) {
            document.getElementById('results').style.display = 'block';
            
            // Display timeline
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '';
            
            data.timeline.forEach(block => {
                const duration = block.end - block.start;
                const div = document.createElement('div');
                div.className = 'timeline-block';
                div.style.width = `${duration * 50}px`;
                div.style.backgroundColor = colors[block.process % colors.length];
                div.textContent = `P${block.process}`;
                timeline.appendChild(div);
            });

            // Display metrics
            const metricsTable = document.getElementById('metrics-table');
            metricsTable.innerHTML = '';
            
            Object.keys(data.turnaround_time).forEach(pid => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>P${pid}</td>
                    <td>${data.turnaround_time[pid]}</td>
                    <td>${data.waiting_time[pid]}</td>
                `;
                metricsTable.appendChild(row);
            });

            // Display averages
            document.getElementById('avg-turnaround').textContent = 
                data.avg_turnaround_time.toFixed(2);
            document.getElementById('avg-waiting').textContent = 
                data.avg_waiting_time.toFixed(2);
        }

        // Add initial process
        addProcess();
    </script>
</body>
</html>
